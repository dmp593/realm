window.setupCreateHouse=function(e){var t=new DataTransfer;document.getElementById("files").addEventListener("change",(function(e){var n=document.getElementById("preview-container");Array.from(e.target.files).forEach((function(r,s){t.items.add(r);var a=document.createElement("div");if(a.classList.add("relative","w-full","h-32","rounded-lg","shadow-md","overflow-hidden"),r.type.startsWith("image/")){var o=new FileReader;o.onload=function(e){var t=document.createElement("img");t.src=e.target.result,t.classList.add("w-full","h-full","object-cover"),a.appendChild(t)},o.readAsDataURL(r)}else if(r.type.startsWith("video/"))if(r.size<262144e3){var i=new FileReader;i.onload=function(e){var t=document.createElement("video");t.src=e.target.result,t.classList.add("w-full","h-full","object-cover"),t.controls=!0,a.appendChild(t)},i.readAsDataURL(r)}else{var d=document.createElement("i");d.classList.add("ph-bold","ph-video","text-4xl","text-gray-500","flex","items-center","justify-center","w-full","h-full"),a.appendChild(d)}else{var l=document.createElement("i");l.classList.add("ph-bold","ph-file","text-4xl","text-gray-500","flex","items-center","justify-center","w-full","h-full"),a.appendChild(l)}var c=document.createElement("span");c.innerHTML='<i class="ph-bold ph-x"></i>',c.classList.add("absolute","top-1","right-1","bg-red-500","text-white","rounded-full","w-6","h-6","flex","items-center","justify-center","cursor-pointer","z-50"),c.addEventListener("click",(function(){a.remove(),t.items.remove(s),e.target.files=t.files})),a.appendChild(c),n.appendChild(a)})),e.target.files=t.files})),document.getElementById("house-form").addEventListener("submit",(function(n){n.preventDefault();var r=document.querySelector('button[type="submit"]');r.classList.add("disabled"),r.disabled=!0,r.innerHTML="A processar...";var s=new FormData(this);fetch("/houses/create",{method:"POST",body:s,headers:{"X-CSRFToken":e}}).then((function(e){return e.json()})).then((function(n){if(n.house_id)return r={houseId:n.house_id,successUrl:n.success_url},s=r.houseId,a=r.successUrl,new Promise((function(n,r){var o=document.getElementById("progress-bar"),i=[],d=t.files,l=1048576,c=3,u=Array.from(d).reduce((function(e,t){return e+t.size}),0),f=0,h=0;function m(t,n,r,a,i,d){var c=t.slice(n*l,(n+1)*l),m=new FormData;m.append("file",c),m.append("chunkIndex",n),m.append("totalChunks",r),m.append("fileId",a),m.append("houseId",s),m.append("filename",i),m.append("order",d),fetch("/houses/".concat(s,"/upload"),{method:"POST",body:m,headers:{"X-CSRFToken":e}}).then((function(e){return e.json()})).then((function(e){"ok"===e.status&&(h+=c.size,o.style.width="".concat(h/u*100,"%")),f--,p()})).catch((function(e){f--,p()}))}function p(){for(;f<c&&i.length>0;){var e=i.shift(),t=e.file,r=e.chunkIndex,o=e.totalChunks,d=e.fileId,l=e.filename,u=e.order;f++,m(t,r,o,d,l,u)}0===i.length&&0===f&&n({houseId:s,successUrl:a})}Array.from(d).forEach((function(e,t){for(var n=Math.ceil(e.size/l),r="house_".concat(t),s=0;s<n;s++)i.push({file:e,chunkIndex:s,totalChunks:n,fileId:r,filename:e.name,order:t+1})})),p()}));var r,s,a;n.errors&&Object.keys(n.errors).forEach((function(e){document.getElementById("error_".concat(e)).innerHTML=n.errors[e].join("<br>")}))})).then((function(e){e&&e.successUrl&&(window.location.href=e.successUrl)})).catch((function(e){})).finally((function(){r.classList.remove("disabled"),r.disabled=!1,r.innerHTML="Criar Casa"}))}))};